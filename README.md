#WebMat

WebMat 是一个基于WEB的矩阵表达式计算器项目，它能在浏览器中完成矩阵表达式的运算，并且提供变量赋值，从文件中导入矩阵，图形化矩阵编辑的功能，同时概念性地支持将较繁重的运算发送的远端进行。  
目前本项目部署于<a href="webmat.rayline97.com">webmat.rayline97.com</a>

##需求分析

WebMat所面对的主要是一种“临时起意”的矩阵运算需求。他可能是一个刚刚在线性代数课程上学习了矩阵相关运算的学生，希望使用计算机验证自己作业的答案是否正确。他可能是一个手边没有电脑的科研人员，手头突然拿到数据，笔算略显困难。任何微小的需求都不是偶然出现的，都值得我们为此提供能够合意的服务。为此，轻量化，无需安装，天然跨平台的WEB无疑成为最合适的平台。
同时应该注意到，如果用户的学习成本应当与他所希望完成的任务相适应，故我们需要追求直觉化的用户体验，避免用户出现刻意大量学习的情况。矩阵自身是复杂的，需要有图形化的表示，同时允许导入本地文件中的矩阵以避免用户二次操作。
另一方面，由于WEB平台的天然性能限制，极端繁重的运算不是主要需要支持的功能，但是应当允许用户在抛弃GUI的相对较高学习成本下完成这一工作，以保证功能的完备。  
综上，本项目需求如下：

+ 进行矩阵运算
+ 进行矩阵表达式运算
+ 短暂存储结果的功能
+ 图形化的矩阵显示、编辑
+ 从本地文件导入矩阵
+ 以上功能需要在一个合理的运算规模内保持良好的用户体验
+ 以上功能需在阅读很少帮助文档的前提下能由用户自行发现使用
+ 相对友好的控制台接口，保证用户可以在无GUI的前提下操作很大的矩阵
+ 支持远端运算以在未来部署高性能服务器加快运算速度
+ 以上功能都应被提供完备的文档

##项目结构

WebMat包括前端与后端两个部分组成，其中主要的工作大多在前端完成，后端的主要作用是支撑网页的发布与远端运算的进行。

###后端结构

WebMat的后端较为简单，主要为静态文件的发布与远端运算的功能实现。运算部分的实现主要依赖于numpy，通过Django框架封装为Restful API。其他所有后端相关内容均位于backEnd目录下。  
实际部署中

###前端结构

前端主要由HTML页面，Javascript脚本组成，自定的CSS样式表内容大部分分散在其中，同时也包括了业界认可的jQuery，Bootstrap框架。  

+ index.html 			主要而唯一的HTML页面，作为脚本运行的容器，提供静态内容的支持。
+ js/pagecontrol.js 	定义了页面的各种行为，处理视觉表现，高层运算逻辑。
+ js/eval.js 			进行表达式求值。
+ js/liblinalg.js 		底层进行各种基本矩阵运算的线性代数库。可独立使用
+ css/index.css 		少部分必须独立存在的CSS内容。

本项目前端使用了以下开源项目。  

+ Bootstrap 			基本视觉效果与页面控件支持。
+ jQuery 				方便的Javascript操作，动画效果。
+ Cookies.js 			提供方便的Cookie操作

除此之外本项目没有参考过其他源代码，完全按照许可协议使用以上开源项目，并对其致以最大的敬意。

##功能详述

###矩阵运算

支持求矩阵的加，减，乘，数乘，求逆，行列式，转置，迹。  
其中矩阵的乘法，求逆，行列式运算的时间复杂度为O(n^3)。  
凭借现代Javascript引擎的力量，在Edge浏览器上我们能以20秒左右的时间完成1000*1000的矩阵乘法运算，并且事实上这个时间很可能包含了一个较大的常数故增长稍缓于单纯的n三次方曲线，对于该规模的运算来说已经能满足相对轻量的需求。同时我们也有着远程运算的机制，它能在更快的时间内完成这样的运算。  

###矩阵表达式求值与变量赋值

实际使用中我们通常面对的并不是单独的运算，而是将各种运算组合为表达式。同时单个矩阵又可能被多次引用，故有需要变量作为临时的存储单位。  
本项目中所使用的表达式由于同时有函数和运算符的存在，故使用类似于转化为前缀表达式的做法将运算符转化为对应的函数。由于Javascript的字符串机制问题效率稍低，故不应进行超大矩阵的直接表达式求值。  
变量赋值系统有效减轻了表达式求值系统相对较低的效率带来的压力，通过将具体矩阵直接复制给变量，再使用较短的表达式进行运算的方式，这方面的效率瓶颈不复存在。  
变量赋值系统主要是通过一个Map实现的，作为一种语言标准提供的对象，其实现方法是可靠的哈希表或平衡树。

###图形化的矩阵表示与编辑

二位数组进行的矩阵表示固然可行，但直观性较差，且在处理稍微大，如10*10的矩阵时由于文本栏长度的原因编辑体验会变得非常差。故在此我们提供了图形化的矩阵编辑方式，并允许在编辑矩阵具体元素时使用表达式并自动求值。同时也提供了人性化的行号列号显示以增强用户体验。

###文件导入功能

有时用户的矩阵存在于文件中，且相对较大，这时有必要允许用户直接从文件中导入矩阵。WEB应用严格的权限控制使得网页只能访问用户提供的文件，且无法写入，十分安全。

###大矩阵处理功能

首先必须明确的是，WebMat并不是一个为处理科学计算级别的巨大矩阵设计的项目，WEB端也不善于处理大量的数据，如果有可能处理大矩阵仍应使用专业工具如MATLAB，Numpy。  
WebMat的哪怕前端中，网页UI也并非是一切，控制台也被设计成用户可以利用的一部分，从而得以规避部分浏览器无法处理的图形负载，过大数据等问题。  
已知可能需要使用控制台处理的情况：  

+ Chrome等浏览器的文本框在输入数据非常大时会遇到输入边界，需要以控制台方式手动赋值变量。注：控制台没有能力读取文件，需要手工粘贴。
+ Edge在文本框内数据过大时会发生不显示的情况，难以判断是否运算完毕。

###移动端适配

移动端作为当前主要的终端之一，WebMat也尽力对其进行适应。基于BootStrap的流式布局系统，能够在当前主流手机上正常显示并运作。为适配移动端也特地在移动端屏蔽了无法使用的加载文件功能。

##用户体验及视觉效果设计

由于缺少专业的设计人员，亦无使时间及天分学习专业的设计思想，本项目采取了直觉为先的用户体验和简约的页面设计风格。

###直觉为先的用户体验

由于本项目的设计目的是为了满足“临时起意”的需求，自然不能指望用户花费大量时间学习使用。
为此，所有视觉效果的功能间都会建立直觉联系。如表达式结构合法则输入框自动变绿，非法变红，修改未赋值变黄。  
同时我们也附加了貌似不是帮助的帮助内容，即最初的示例内容，通过它来帮助用户快速理解本项目与其他矩阵计算器稍有不同的思路。  

###简约的设计风格

整个页面除了用于提供帮助和设置功能并保持页面平衡的导航栏外，仅有变量，表达式，按钮的行分布布局。事实上除网站图标外没有直接图片应用。简洁明快的动画也使网页看起来更为流畅。

##项目运作情况

###项目完成情况

当前WebMat已经基本完成了逻辑施工与文档编写。由于缺乏设计人员，WebMat将继续保持简约的设计风格。项目经过实际使用的测试可以无bug地正常使用，存在某些浏览器无故大量报错的现象但于实际使用并无影响。有关大矩阵运算及远端运算的相关内容有进一步改进优化的空间。

###项目难点及突破情况

+ Javascript效率疑虑						经测试并没有太大的担心必要
+ 文件载入功能							ECMAScript新标准中的文件API满足需求
+ 在不运算的前提下判断字符串是否是矩阵		正则表达式匹配
+ 运算结果中出现极小无意义部分				增加精度选项，给用户降低一定精度换取更好的体验的权利
+ 矩阵中括号与逗号的优先级问题				向相应位置增加小括号
+ 移动端布局 							BootStrap流式布局系统对高低分辨率的区别对待

##相关帮助

###项目部署

WebMat的前后端应当一同部署，将前端的静态文件直接部署至web服务器，并将支持WSGI接口的后端脚本部署在同一服务器同一站点的/api目录下，后端具体部署应当查看后端文档。  
前端亦可直接使用，但应当关闭远端计算。

###使用帮助

WebMat不期望用户主要通过帮助信息学会使用，同时WebMat的网页内部已经内置了一套完整的帮助信息，故在此仅体现部分关键信息。

####矩阵表示

矩阵应当通过二维数组的形式表示，如[[1,2],[3,4]]。即使是1*4的矩阵也应当表示为[[1,2,3,4]]

####表达式定义

1. 判断一个字符串是否是表达式前，应当把其中一切变量以值替代
2. 一个数是表达式
3. S1是表达式，则(S1)是表达式
4. S1，S2是表达式，则S1+S2, S1-S2, -S1, S1*S2, S1/S2是表达式
5. S1是表达式,F()是函数，则F(S1)是表达式
6. S11...Snm是表达式，则[[S11,..,S1m],...,[Sn1,...,Snm]]是表达式

####函数定义

#####det(M)/determinant(M)

求矩阵M的行列式，要求为方阵

#####inv(M)/inverse(M)

求矩阵M的逆矩阵，要求M为满秩方阵

#####trace(M)

求矩阵的迹

#####trans(M)/transpose(M)

求矩阵的转置

####输入框状态说明

红色：出现错误
绿色：正常，不保证运算不出现数学错误，但保证参与运算的矩阵结构正确
黄色：发生了更改而为存入变量

####控制台说明

在网页中打开控制台应当有其说明出现，如未出现保持控制台出现并刷新可以获得说明。  
对大部分用户来说这是不必要的，然而如果一定要进行超过GUI承受范围的运算，则控制台运算不失为一种选择。  
我们仅推荐使用三个控制台函数，请不要试图使用其余函数，这没有什么意义。

+ assign(name, value) 				给变量赋值
+ getVar(name) 						获得变量的值
+ evalMatExpression(expression)		表达式求值

##版权情况

本项目基于MIT协议发布，您可以任意使用，复制，修改，分发它，详情见LICENSE文件。